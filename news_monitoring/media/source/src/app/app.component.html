<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Sources List</h2>
    <button class="btn btn-primary" (click)="add()">Add Source</button>
  </div>

  <input
    type="text"
    placeholder="Search by name..."
    [(ngModel)]="searchQuery"
    (input)="onSearchChange()"
    class="form-control mb-3"
  />

  <!-- No sources message -->
  <div *ngIf="sources.length === 0" class="alert alert-info">
    No sources found
  </div>

  <!-- Sources table -->
  <table *ngIf="sources.length > 0" class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>URL</th>
        <th>Tagged Companies</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let source of sources">
        <td>{{ source.name }}</td>
        <td><a [href]="source.url" target="_blank">{{ source.url }}</a></td>
      <td>
        <ng-container *ngIf="source.tagged_companies && source.tagged_companies.length > 0; else noCompanies">
          <ng-container *ngFor="let company of source.tagged_companies;">
            {{ company.name }}
          </ng-container>
        </ng-container>
        <ng-template #noCompanies>
          N/A
        </ng-template>
      </td>
        <td>
          <button (click)="edit(source)" class="btn btn-sm btn-primary me-1">Edit</button>
          <button (click)="delete(source)" class="btn btn-sm btn-danger me-1">Delete</button>
          <button (click)="fetchStories(source.id)" class="btn btn-sm btn-success">Fetch Stories</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <nav *ngIf="totalItems > pageSize" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="onPageChange(currentPage - 1)">Previous</a>
      </li>

      <li class="page-item" *ngFor="let page of [].constructor(Math.ceil(totalItems / pageSize)); let i = index"
          [class.active]="i + 1 === currentPage">
        <a class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === Math.ceil(totalItems / pageSize)">
        <a class="page-link" (click)="onPageChange(currentPage + 1)">Next</a>
      </li>
    </ul>
  </nav>
</div>


<!--&lt;!&ndash; Stories Modal &ndash;&gt;-->
<!--<div class="modal-container" *ngIf="showStoriesModal">-->
<!--  <div-->
<!--    class="modal fade show"-->
<!--    tabindex="-1"-->
<!--    [ngStyle]="{ display: showStoriesModal ? 'block' : 'none' }"-->
<!--  >-->
<!--    <div class="modal-dialog modal-lg">-->
<!--      <div class="modal-content">-->
<!--        <div class="modal-header">-->
<!--          <h5 class="modal-title">-->
<!--            Recently Imported Stories for {{ currentSource?.name }}-->
<!--          </h5>-->
<!--          <button type="button" class="btn-close" (click)="closeStoriesModal()"></button>-->
<!--        </div>-->

<!--        <div class="modal-body">-->
<!--          <div *ngIf="importedStories.length === 0" class="alert alert-info">-->
<!--            No new stories were imported.-->
<!--          </div>-->

<!--          <div *ngIf="importedStories.length > 0">-->
<!--            <h6>{{ importedStories.length }} new stories imported:</h6>-->
<!--            <div class="list-group">-->
<!--              <div class="list-group-item list-group-item-action" *ngFor="let story of importedStories">-->
<!--                <div class="d-flex w-100 justify-content-between">-->
<!--                  <h5 class="mb-1"><a [href]="story.article_url" target="_blank">{{ story.title }}</a></h5>-->
<!--                  <small>{{ story.published_date | date:'medium' }}</small>-->
<!--                </div>-->
<!--                <p class="mb-1">{{ story.body_text | slice:0:200 }}{{ story.body_text.length > 200 ? '...' : '' }}</p>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        <div class="modal-footer">-->
<!--          <button class="btn btn-secondary" (click)="closeStoriesModal()">Close</button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Separate backdrop element &ndash;&gt;-->
<!--  <div class="modal-backdrop fade show"></div>-->
<!--</div>-->

<router-outlet></router-outlet>
