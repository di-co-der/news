<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Sources List</h2>
    <button class="btn btn-primary" (click)="openAddModal()">Add Source</button>
  </div>

  <input
    type="text"
    placeholder="Search by name..."
    [(ngModel)]="searchQuery"
    (input)="onSearchChange()"
    class="form-control mb-3"
  />

  <!-- Show a message when no sources are found -->
  <div *ngIf="sources.length === 0" class="alert alert-info">
    No sources found
  </div>

  <!-- Only show the table when sources exist -->
  <table *ngIf="sources.length > 0" class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>URL</th>
        <th>Tagged Companies</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let source of sources">
        <td>{{ source.name }}</td>
        <td><a [href]="source.url" target="_blank">{{ source.url }}</a></td>
        <td>
          <ng-container *ngIf="source.tagged_companies?.length; else noTags">
            {{ source.tagged_companies?.join(', ') || 'N/A' }}
          </ng-container>
          <ng-template #noTags>N/A</ng-template>
        </td>
        <td>
          <button (click)="openEditModal(source)" class="btn btn-sm btn-primary me-1">Edit</button>
          <button (click)="deleteSource(source.id)" class="btn btn-sm btn-danger me-1">Delete</button>
          <button (click)="fetchStory(source.id)" class="btn btn-sm btn-success">Fetch Story</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Add pagination component here -->
  <nav *ngIf="totalItems > pageSize" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="onPageChange(currentPage - 1)">Previous</a>
      </li>

      <li class="page-item" *ngFor="let page of getPages()" [class.active]="page === currentPage">
        <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === Math.ceil(totalItems / pageSize)">
        <a class="page-link" (click)="onPageChange(currentPage + 1)">Next</a>
      </li>
    </ul>
  </nav>
</div>

<!-- Modal implementation with proper z-index handling -->
<div class="modal-container" *ngIf="showModal">
  <div
    class="modal fade show"
    tabindex="-1"
    [ngStyle]="{ display: showModal ? 'block' : 'none' }"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            {{ isEditMode ? 'Edit Source' : 'Add Source' }}
          </h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>

        <div class="modal-body">
          <form [formGroup]="sourceForm" (ngSubmit)="submitForm()">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input
                formControlName="name"
                class="form-control"
                [class.is-invalid]="sourceForm.get('name')?.invalid && sourceForm.get('name')?.touched"
              />
              <div class="invalid-feedback">Name is required</div>
            </div>

            <div class="mb-3">
              <label class="form-label">URL</label>
              <input
                formControlName="url"
                class="form-control"
                [class.is-invalid]="sourceForm.get('url')?.invalid && sourceForm.get('url')?.touched"
              />
              <div class="invalid-feedback">Valid URL is required</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Tagged Companies</label>
              <select
                formControlName="tagged_companies"
                class="form-select"
                multiple
              >
                <option *ngFor="let company of companies" [value]="company.id">
                  {{ company.name }}
                </option>
              </select>
              <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple companies</small>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button
            class="btn btn-primary"
            [disabled]="sourceForm.invalid"
            (click)="submitForm()"
          >
            {{ isEditMode ? 'Update' : 'Save' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Separate backdrop element -->
  <div class="modal-backdrop fade show"></div>
</div>
